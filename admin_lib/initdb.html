<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBåˆæœŸåŒ–</title>
    <link rel="stylesheet" href="../style.css">
    <link href="../lib/tailwind.css" rel="stylesheet">
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/osql.js"></script>
    <script src="../isapp.js"></script>
    <script>
        osql.requireLogin();
        $(document).ready(init);

        async function init() {
            await isapp.initUser();
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤º
            const me = await osql.getMe();
            document.getElementById('header-username').innerText = me.lname + ' ' + me.fname;
            document.getElementById('user-initials').innerText = (me.lname.charAt(0) + me.fname.charAt(0)).toUpperCase();
        }

        const initSQL = `
-- ç°¡ç´ åŒ–ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
-- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ãŸã‚ã€ä¾å­˜é–¢ä¿‚ã®é€†é †ã§å‰Šé™¤
DROP TABLE IF EXISTS selections;
DROP TABLE IF EXISTS projects;
DROP TABLE IF EXISTS classes;
DROP TABLE IF EXISTS users;

-- usersãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
    id VARCHAR(255) PRIMARY KEY,
    fname VARCHAR(255) NOT NULL,
    lname VARCHAR(255) NOT NULL,
    role VARCHAR(255) NOT NULL
);

-- classesãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE classes (
    id VARCHAR(255) PRIMARY KEY,
    year INT NOT NULL,
    day_of_week VARCHAR(10) NOT NULL,
    period INT NOT NULL,
    semester VARCHAR(20) NOT NULL,
    title VARCHAR(255) NOT NULL,
    credit INT NOT NULL,
    professor_name VARCHAR(255) NOT NULL,
    room_no VARCHAR(50) NOT NULL
);

-- projectsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE projects (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    year INT NOT NULL,
    semester VARCHAR(20) NOT NULL,
    public BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- selectionsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE selections (
    id VARCHAR(255) PRIMARY KEY,
    project_id VARCHAR(255) NOT NULL,
    class_id VARCHAR(255) NOT NULL,
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (class_id) REFERENCES classes(id)
);
`;
        async function initializeDatabase() {
            showStatusMessage();
            const statusEl = $('#status-message');
            const button = $('button[onclick="initializeDatabase()"]');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            button.prop('disabled', true).html('â³ å‡¦ç†ä¸­...');
            
            statusEl.html('<div class="text-blue-600 font-semibold">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...</div><br>');
            
            try {
                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
                statusEl.append('<div class="text-gray-600">ğŸ‘¤ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</div>');
                const me = await osql.getMe();
                if (!me) {
                    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                statusEl.append(`<div class="text-green-600 ml-4">âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—å®Œäº†: ${me.lname} ${me.fname} (${me.id})</div><br>`);
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆSQLå®Ÿè¡Œ
                const sqlStatements = initSQL.split(';').map(s => s.trim()).filter(s => s.length > 0);
                const totalStatements = sqlStatements.length + 1; // +1 for user insertion

                for (let i = 0; i < sqlStatements.length; i++) {
                    const sql = sqlStatements[i];
                    const progress = Math.round(((i + 1) / totalStatements) * 100);
                    
                    statusEl.append(`<div class="text-gray-600">ğŸ”„ å®Ÿè¡Œä¸­: ${sql.substring(0, 60)}${sql.length > 60 ? '...' : ''}</div>`);
                    
                    const result = await osql.connect(sql, false);
                    if (result.status === 200) {
                        statusEl.append(`<div class="text-green-600 ml-4">âœ… æˆåŠŸ (é€²æ—: ${progress}%)</div><br>`);
                    } else {
                        statusEl.append(`<div class="text-red-600 ml-4">âŒ å¤±æ•—: ${result.message}</div><br>`);
                        console.error(result);
                        throw new Error(result.message);
                    }
                }
                
                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’usersãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
                statusEl.append('<div class="text-gray-600">ğŸ‘¤ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŒ¿å…¥ä¸­...</div>');
                const insertUserSQL = `INSERT INTO users (id, fname, lname, role) VALUES ('${me.id}', '${me.fname}', '${me.lname}', 'admin')`;
                const userResult = await osql.connect(insertUserSQL, false);
                
                if (userResult.status === 200) {
                    statusEl.append(`<div class="text-green-600 ml-4">âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æŒ¿å…¥å®Œäº† (é€²æ—: 100%)</div><br>`);
                } else {
                    statusEl.append(`<div class="text-red-600 ml-4">âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æŒ¿å…¥å¤±æ•—: ${userResult.message}</div><br>`);
                    console.error(userResult);
                    throw new Error(userResult.message);
                }
                
                statusEl.append('<div class="bg-green-100 text-green-800 p-4 rounded-lg border border-green-200 mt-4 font-semibold">ğŸ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼</div>');
                
                button.html('âœ… åˆæœŸåŒ–å®Œäº†').removeClass('bg-red-600 hover:bg-red-700').addClass('bg-green-600 hover:bg-green-700');
                
            } catch (error) {
                statusEl.append(`<div class="bg-red-100 text-red-800 p-4 rounded-lg border border-red-200 mt-4 font-semibold">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`);
                console.error(error);
                
                button.prop('disabled', false).html('ğŸ”„ å†è©¦è¡Œ').removeClass('bg-green-600 hover:bg-green-700').addClass('bg-red-600 hover:bg-red-700');
            }
        }

        // CSVèª­ã¿è¾¼ã¿æ©Ÿèƒ½
        let currentFile = null;
        
        function handleCSVFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = file;
            loadCSVWithEncoding();
        }
        
        function loadCSVWithEncoding() {
            if (!currentFile) return;
            
            const encoding = document.getElementById('encoding-select').value;
            const previewEl = document.getElementById('csv-preview');
            
            // èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤º
            previewEl.innerHTML = '<div class="text-gray-600">ğŸ“– ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            previewEl.classList.remove('hidden');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    parseAndPreviewCSV(csv);
                } catch (error) {
                    previewEl.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}<br><p class="text-sm mt-2">æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p></div>`;
                }
            };
            
            reader.onerror = function() {
                previewEl.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br><p class="text-sm mt-2">æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p></div>`;
            };
            
            // é¸æŠã•ã‚ŒãŸæ–‡å­—ã‚³ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
            try {
                if (encoding === 'utf-8') {
                    reader.readAsText(currentFile, 'UTF-8');
                } else if (encoding === 'shift_jis') {
                    reader.readAsText(currentFile, 'Shift_JIS');
                } else if (encoding === 'euc-jp') {
                    reader.readAsText(currentFile, 'EUC-JP');
                } else {
                    reader.readAsText(currentFile, 'UTF-8'); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                }
            } catch (error) {
                previewEl.innerHTML = `<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">âŒ æ–‡å­—ã‚³ãƒ¼ãƒ‰ "${encoding}" ã§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
            }
        }

        function parseAndPreviewCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const previewEl = document.getElementById('csv-preview');
            const importBtn = document.getElementById('import-csv-btn');
            const hasHeader = document.getElementById('header-option').value === 'true';
            
            if (lines.length === 0 || (hasHeader && lines.length < 2)) {
                previewEl.innerHTML = '<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">âŒ CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã¾ãŸã¯ç„¡åŠ¹ã§ã™</div>';
                importBtn.classList.add('hidden');
                return;
            }
            
            // CSVãƒ‘ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };
            
            let headers;
            let rows;
            
            if (hasHeader) {
                // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒã‚ã‚‹å ´åˆ
                headers = parseCSVLine(lines[0]);
                rows = lines.slice(1).map(line => parseCSVLine(line));
            } else {
                // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒãªã„å ´åˆ
                const firstRow = parseCSVLine(lines[0]);
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’åˆ—ç•ªå·ã§ç”Ÿæˆï¼ˆCol1, Col2, ...ï¼‰
                headers = Array.from({ length: firstRow.length }, (_, i) => `åˆ—${i+1}`);
                rows = lines.map(line => parseCSVLine(line));
            }
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆTailwindã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
            let html = '<div class="bg-gray-50 border border-gray-200 rounded-xl p-4 mt-4">';
            html += '<h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center"><span class="mr-2">ğŸ“‹</span>CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>';
            html += '<div class="overflow-x-auto">';
            html += '<table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-50"><tr>';
            headers.forEach(header => {
                html += `<th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 border-b border-gray-200">${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            rows.slice(0, 5).forEach((row, index) => {
                html += `<tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">`;
                row.forEach(cell => {
                    html += `<td class="px-4 py-2 text-sm text-gray-900 border-b border-gray-200">${cell}</td>`;
                });
                html += '</tr>';
            });
            
            if (rows.length > 5) {
                html += `<tr class="bg-blue-50"><td colspan="${headers.length}" class="px-4 py-2 text-center text-sm text-blue-700 font-medium">... ä»– ${rows.length - 5} ä»¶ã®ãƒ¬ã‚³ãƒ¼ãƒ‰</td></tr>`;
            }
            
            html += '</tbody></table></div>';
            html += `<div class="mt-3 text-sm text-gray-600 flex items-center"><span class="mr-2">ğŸ“Š</span>åˆè¨ˆ: ${rows.length} ä»¶ã®ãƒ¬ã‚³ãƒ¼ãƒ‰</div>`;
            html += '</div>';
            
            previewEl.innerHTML = html;
            importBtn.classList.remove('hidden');
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            window.csvData = { headers, rows, hasHeader };
        }

        async function importCSVData() {
            if (!window.csvData) {
                alert('CSVãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            const statusEl = document.getElementById('csv-status');
            const importBtn = document.getElementById('import-csv-btn');
            
            statusEl.classList.remove('hidden');
            statusEl.innerHTML = '<div class="text-blue-600 font-semibold">ğŸ“¥ CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...</div><br>';
            importBtn.disabled = true;
            
            try {
                const { rows } = window.csvData;
                let successCount = 0;
                let errorCount = 0;
                
                // æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨è¨­å®šæƒ…å ±ã‚’è¡¨ç¤º
                const encoding = document.getElementById('encoding-select').value;
                const hasHeader = document.getElementById('header-option').value === 'true';
                
                statusEl.innerHTML += `<div class="text-gray-600">â„¹ï¸ æ–‡å­—ã‚³ãƒ¼ãƒ‰: ${encoding}, ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ: ${hasHeader ? 'ã‚ã‚Š' : 'ãªã—'}</div><br>`;
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const progress = Math.round(((i + 1) / rows.length) * 100);
                    const rowNum = hasHeader ? i + 2 : i + 1; // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒã‚ã‚‹å ´åˆã¯å®Ÿéš›ã®è¡Œç•ªå·ã‚’èª¿æ•´
                    
                    // å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°
                    // æƒ³å®š: year, day_of_week, period, semester, title, credit, professor_name, room_no
                    if (row.length < 8) {
                        statusEl.innerHTML += `<div class="text-red-600">âŒ è¡Œ ${rowNum}: åˆ—æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ (${row.length}/8)</div>`;
                        errorCount++;
                        continue;
                    }
                    
                    // SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ã®ãŸã‚ã«ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
                    const escapedValues = row.map(val => {
                        if (typeof val === 'string') {
                            return val.replace(/'/g, "''");
                        }
                        return val;
                    });
                    
                    // UUIDã‚’è‡ªå‹•ç”Ÿæˆã—ã¦IDã¨ã—ã¦ä½¿ç”¨
                    const uuid = crypto.randomUUID();
                    
                    // year, day_of_week, period, semester, title, credit, professor_name, room_no
                    const insertSQL = `INSERT INTO classes (id, year, day_of_week, period, semester, title, credit, professor_name, room_no) 
                        VALUES ('${uuid}', ${escapedValues[0]}, '${escapedValues[1]}', ${escapedValues[2]}, '${escapedValues[3]}', '${escapedValues[4]}', ${escapedValues[5]}, '${escapedValues[6]}', '${escapedValues[7]}')`;
                    
                    try {
                        const result = await osql.connect(insertSQL, false);
                        if (result.status === 200) {
                            successCount++;
                            if (i % 10 === 0 || i === rows.length - 1) {
                                statusEl.innerHTML += `<div class="text-green-600">âœ… ${successCount} ä»¶å‡¦ç†å®Œäº† (é€²æ—: ${progress}%)</div>`;
                            }
                        } else {
                            statusEl.innerHTML += `<div class="text-red-600">âŒ è¡Œ ${rowNum}: ${result.message}</div>`;
                            errorCount++;
                        }
                    } catch (error) {
                        statusEl.innerHTML += `<div class="text-red-600">âŒ è¡Œ ${rowNum}: ${error.message}</div>`;
                        errorCount++;
                    }
                }
                
                statusEl.innerHTML += `<div class="bg-green-100 text-green-800 p-4 rounded-lg border border-green-200 mt-4 font-semibold">ğŸ‰ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼æˆåŠŸ: ${successCount}ä»¶ã€å¤±æ•—: ${errorCount}ä»¶</div>`;
                
            } catch (error) {
                statusEl.innerHTML += `<div class="bg-red-100 text-red-800 p-4 rounded-lg border border-red-200 mt-4 font-semibold">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`;
            } finally {
                importBtn.disabled = false;
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡
        function showStatusMessage() {
            const statusEl = document.getElementById('status-message');
            statusEl.classList.remove('hidden');
            statusEl.innerHTML = '';
        }
    </script>
</head>

<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <!-- Modern Header with Tailwind -->
    <header class="bg-white/95 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Left side -->
                <div class="flex items-center space-x-8">
                    <!-- Brand -->
                    <a href="../index.html" class="flex items-center space-x-3 text-gray-900 hover:text-blue-600 transition-colors">
                        <span class="text-3xl">ğŸ“</span>
                        <div>
                            <h1 class="text-xl font-bold">SmartCampus</h1>
                            <span class="text-sm text-gray-500">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†</span>
                        </div>
                    </a>
                    
                    <!-- Navigation -->
                    <nav class="hidden md:flex space-x-2">
                        <a href="../index.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors">
                            ğŸ  <span class="ml-1">ãƒ›ãƒ¼ãƒ </span>
                        </a>
                        <a href="../schedule.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors">
                            ğŸ“… <span class="ml-1">æ™‚é–“å‰²è¡¨</span>
                        </a>
                        <a href="../courses.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-colors">
                            ğŸ“š <span class="ml-1">ç§‘ç›®ä¸€è¦§</span>
                        </a>
                        <a href="initdb.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-700 border border-blue-200">
                            âš™ï¸ <span class="ml-1">ç®¡ç†</span>
                        </a>
                    </nav>
                </div>
                
                <!-- Right side -->
                <div class="flex items-center space-x-4">
                    <!-- User profile -->
                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors" onclick="isapp.openUserProfile('..')">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white text-sm font-bold" id="user-initials">ğŸ‘¤</div>
                        <span class="text-sm font-medium text-gray-700" id="header-username">Loading...</span>
                    </div>
                    <!-- Logout button -->
                    <button onclick="isapp.logout()" class="px-4 py-2 text-sm font-medium text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
            
            <!-- Mobile navigation -->
            <div class="md:hidden pb-4">
                <nav class="grid grid-cols-2 gap-2">
                    <a href="../index.html" class="flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
                        ğŸ  ãƒ›ãƒ¼ãƒ 
                    </a>
                    <a href="../schedule.html" class="flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
                        ğŸ“… æ™‚é–“å‰²è¡¨
                    </a>
                    <a href="../courses.html" class="flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
                        ğŸ“š ç§‘ç›®ä¸€è¦§
                    </a>
                    <a href="initdb.html" class="flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-700">
                        âš™ï¸ ç®¡ç†
                    </a>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Breadcrumb Navigation -->
    <nav class="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <ol class="flex items-center space-x-2 text-sm">
                <li>
                    <a href="../index.html" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">ãƒ›ãƒ¼ãƒ </a>
                </li>
                <li>
                    <span class="text-gray-400 font-semibold">></span>
                </li>
                <li>
                    <a href="index.html" class="text-blue-600 hover:text-blue-700 font-medium transition-colors">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</a>
                </li>
                <li>
                    <span class="text-gray-400 font-semibold">></span>
                </li>
                <li>
                    <span class="text-gray-700 font-semibold">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–</span>
                </li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <!-- Database Initialization Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-red-50 to-pink-50 px-6 py-8 border-b border-gray-100">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between">
                    <div class="mb-4 lg:mb-0">
                        <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center mb-2">
                            ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
                        </h1>
                        <p class="text-gray-600">ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™</p>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6">
                <!-- Warning Alert -->
                <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                    <div class="flex items-center">
                        <div class="text-red-400 mr-3">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-red-800">âš ï¸ é‡è¦ãªè­¦å‘Š</h3>
                            <p class="text-red-700 mt-1">ã“ã®æ“ä½œã«ã‚ˆã‚Šæ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                </div>
                
                <!-- Initialize Button -->
                <button onclick="initializeDatabase()" class="w-full sm:w-auto px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl">
                    <span>ğŸ—„ï¸</span>
                    <span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚’å®Ÿè¡Œ</span>
                </button>
                
                <!-- Status Message -->
                <div id="status-message" class="hidden mt-6 bg-gray-50 border border-gray-200 rounded-xl p-4 font-mono text-sm text-gray-700 max-h-80 overflow-y-auto">
                    å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                </div>
            </div>
        </div>

        <!-- CSV Import Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-8 border-b border-gray-100">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between">
                    <div class="mb-4 lg:mb-0">
                        <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 flex items-center mb-2">
                            ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                        </h2>
                        <p class="text-gray-600">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æˆæ¥­ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç™»éŒ²</p>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6 space-y-6">
                <!-- Format Info -->
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="text-blue-400 mr-3">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-blue-800">â„¹ï¸ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h3>
                    </div>
                    <p class="text-blue-700">
                        åˆ—é †: year, day_of_week, period, semester, title, credit, professor_name, room_no<br>
                        ä¾‹: 2024,"æœˆ",1,"å‰æœŸ","ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤",2,"ç”°ä¸­å¤ªéƒ","A101"
                    </p>
                </div>

                <!-- Tips -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                    <div class="flex items-center mb-2">
                        <div class="text-yellow-400 mr-3">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-yellow-800">ğŸ’¡ ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¨­å®šã®ãƒ’ãƒ³ãƒˆ</h3>
                    </div>
                    <ul class="text-yellow-700 space-y-1">
                        <li><strong>æ–‡å­—ã‚³ãƒ¼ãƒ‰</strong>: æ–‡å­—åŒ–ã‘ã™ã‚‹å ´åˆã¯åˆ¥ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ</li>
                        <li><strong>ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ</strong>: Excelãªã©ã§åˆ—åãŒã‚ã‚‹å ´åˆã¯ã€Œã‚ã‚Šã€ã‚’é¸æŠ</li>
                        <li><strong>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</strong>: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠå¾Œã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</li>
                    </ul>
                </div>

                <!-- File Upload Controls -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Encoding Selection -->
                    <div>
                        <label for="encoding-select" class="block text-sm font-semibold text-gray-700 mb-2">
                            ğŸŒ æ–‡å­—ã‚³ãƒ¼ãƒ‰
                        </label>
                        <select id="encoding-select" onchange="loadCSVWithEncoding()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="utf-8">UTF-8 (æ¨å¥¨)</option>
                            <option value="shift_jis">Shift_JIS (Windowsæ¨™æº–)</option>
                            <option value="euc-jp">EUC-JP (Unixç³»)</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">æ–‡å­—åŒ–ã‘ã—ãŸå ´åˆã¯åˆ¥ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ãŠè©¦ã—ãã ã•ã„</p>
                    </div>

                    <!-- Header Option -->
                    <div>
                        <label for="header-option" class="block text-sm font-semibold text-gray-700 mb-2">
                            ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
                        </label>
                        <select id="header-option" onchange="loadCSVWithEncoding()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                            <option value="true">ã‚ã‚Šï¼ˆ1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨ï¼‰</option>
                            <option value="false">ãªã—ï¼ˆå…¨ã¦ã®è¡Œã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ï¼‰</option>
                        </select>
                    </div>
                </div>

                <!-- File Input -->
                <div>
                    <label for="csv-file" class="block text-sm font-semibold text-gray-700 mb-2">
                        ğŸ“ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                    </label>
                    <input type="file" id="csv-file" accept=".csv" onchange="handleCSVFile(event)" 
                           class="w-full px-3 py-2 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 focus:border-blue-500 focus:outline-none transition-colors bg-gray-50 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                
                <!-- CSV Preview -->
                <div id="csv-preview" class="hidden"></div>
                
                <!-- Import Button -->
                <button id="import-csv-btn" onclick="importCSVData()" 
                        class="hidden w-full sm:w-auto px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl">
                    <span>ğŸ“¥</span>
                    <span>CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</span>
                </button>
                
                <!-- CSV Status -->
                <div id="csv-status" class="hidden bg-gray-50 border border-gray-200 rounded-xl p-4 font-mono text-sm text-gray-700 max-h-80 overflow-y-auto"></div>
            </div>
        </div>
        
        <!-- Other Tools Card -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-gray-50 to-slate-50 px-6 py-6 border-b border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 flex items-center">
                    ğŸ”§ ãã®ä»–ã®ãƒ„ãƒ¼ãƒ«
                </h2>
            </div>
            
            <!-- Content -->
            <div class="p-6">
                <div class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl hover:shadow-md transition-shadow">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white text-xl">
                            ğŸ—„ï¸
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">dbkisoã‚µãƒ¼ãƒ</h3>
                            <p class="text-sm text-gray-600">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹</p>
                        </div>
                    </div>
                    <a href="https://dbkiso.si.aoyama.ac.jp" target="_blank" 
                       class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-sm hover:shadow-md">
                        ã‚¢ã‚¯ã‚»ã‚¹ â†’
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>

</html>