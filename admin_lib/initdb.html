<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBåˆæœŸåŒ–</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../lib/jquery.min.js"></script>
    <script src="../lib/osql.js"></script>
    <script src="../isapp.js"></script>
    <script>
        osql.requireLogin();
        $(document).ready(init);

        async function init() {
            await isapp.initUser();
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤º
            const me = await osql.getMe();
            document.getElementById('header-username').innerText = me.lname + ' ' + me.fname;
            document.getElementById('user-initials').innerText = (me.lname.charAt(0) + me.fname.charAt(0)).toUpperCase();
        }

        const initSQL = `
-- ç°¡ç´ åŒ–ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
-- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®ãŸã‚ã€ä¾å­˜é–¢ä¿‚ã®é€†é †ã§å‰Šé™¤
DROP TABLE IF EXISTS selections;
DROP TABLE IF EXISTS projects;
DROP TABLE IF EXISTS classes;
DROP TABLE IF EXISTS users;

-- usersãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
    id VARCHAR(255) PRIMARY KEY,
    fname VARCHAR(255) NOT NULL,
    lname VARCHAR(255) NOT NULL,
    role VARCHAR(255) NOT NULL
);

-- classesãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE classes (
    id VARCHAR(255) PRIMARY KEY,
    year INT NOT NULL,
    day_of_week VARCHAR(10) NOT NULL,
    period INT NOT NULL,
    semester VARCHAR(20) NOT NULL,
    title VARCHAR(255) NOT NULL,
    credit INT NOT NULL,
    professor_name VARCHAR(255) NOT NULL,
    room_no VARCHAR(50) NOT NULL
);

-- projectsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE projects (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    year INT NOT NULL,
    semester VARCHAR(20) NOT NULL,
    public BOOLEAN NOT NULL DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- selectionsãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE selections (
    id VARCHAR(255) PRIMARY KEY,
    project_id VARCHAR(255) NOT NULL,
    class_id VARCHAR(255) NOT NULL,
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (class_id) REFERENCES classes(id)
);
`;
        async function initializeDatabase() {
            showStatusMessage();
            const statusEl = $('#status-message');
            const button = $('button[onclick="initializeDatabase()"]');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            button.prop('disabled', true).html('â³ å‡¦ç†ä¸­...');
            
            statusEl.html('<div style="color: #3b82f6; font-weight: 600;">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...</div><br>');
            
            try {
                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
                statusEl.append('<div style="color: #6b7280;">ğŸ‘¤ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...</div>');
                const me = await osql.getMe();
                if (!me) {
                    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                statusEl.append(`<div style="color: #059669; margin-left: 1rem;">âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—å®Œäº†: ${me.lname} ${me.fname} (${me.id})</div><br>`);
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆSQLå®Ÿè¡Œ
                const sqlStatements = initSQL.split(';').map(s => s.trim()).filter(s => s.length > 0);
                const totalStatements = sqlStatements.length + 1; // +1 for user insertion

                for (let i = 0; i < sqlStatements.length; i++) {
                    const sql = sqlStatements[i];
                    const progress = Math.round(((i + 1) / totalStatements) * 100);
                    
                    statusEl.append(`<div style="color: #6b7280;">ğŸ”„ å®Ÿè¡Œä¸­: ${sql.substring(0, 60)}${sql.length > 60 ? '...' : ''}</div>`);
                    
                    const result = await osql.connect(sql, false);
                    if (result.status === 200) {
                        statusEl.append(`<div style="color: #059669; margin-left: 1rem;">âœ… æˆåŠŸ (é€²æ—: ${progress}%)</div><br>`);
                    } else {
                        statusEl.append(`<div style="color: #dc2626; margin-left: 1rem;">âŒ å¤±æ•—: ${result.message}</div><br>`);
                        console.error(result);
                        throw new Error(result.message);
                    }
                }
                
                // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’usersãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
                statusEl.append('<div style="color: #6b7280;">ğŸ‘¤ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŒ¿å…¥ä¸­...</div>');
                const insertUserSQL = `INSERT INTO users (id, fname, lname, role) VALUES ('${me.id}', '${me.fname}', '${me.lname}', 'admin')`;
                const userResult = await osql.connect(insertUserSQL, false);
                
                if (userResult.status === 200) {
                    statusEl.append(`<div style="color: #059669; margin-left: 1rem;">âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æŒ¿å…¥å®Œäº† (é€²æ—: 100%)</div><br>`);
                } else {
                    statusEl.append(`<div style="color: #dc2626; margin-left: 1rem;">âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æŒ¿å…¥å¤±æ•—: ${userResult.message}</div><br>`);
                    console.error(userResult);
                    throw new Error(userResult.message);
                }
                
                statusEl.append('<div style="background: #d1fae5; color: #065f46; padding: 1rem; border-radius: 0.5rem; border: 1px solid #a7f3d0; margin-top: 1rem; font-weight: 600;">ğŸ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼</div>');
                
                button.html('âœ… åˆæœŸåŒ–å®Œäº†').css('background', '#059669');
                
            } catch (error) {
                statusEl.append(`<div style="background: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fecaca; margin-top: 1rem; font-weight: 600;">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`);
                console.error(error);
                
                button.prop('disabled', false).html('ğŸ”„ å†è©¦è¡Œ').css('background', '#dc2626');
            }
        }

        // CSVèª­ã¿è¾¼ã¿æ©Ÿèƒ½
        let currentFile = null;
        
        function handleCSVFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = file;
            loadCSVWithEncoding();
        }
        
        function loadCSVWithEncoding() {
            if (!currentFile) return;
            
            const encoding = document.getElementById('encoding-select').value;
            const previewEl = document.getElementById('csv-preview');
            
            // èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤º
            previewEl.innerHTML = '<div style="color: #6b7280;">ğŸ“– ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    parseAndPreviewCSV(csv);
                } catch (error) {
                    previewEl.innerHTML = `<div style="color: #dc2626;">âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</div>
                        <p style="color: #6b7280; font-size: 0.875rem;">æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>`;
                }
            };
            
            reader.onerror = function() {
                previewEl.innerHTML = `<div style="color: #dc2626;">âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>
                    <p style="color: #6b7280; font-size: 0.875rem;">æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>`;
            };
            
            // é¸æŠã•ã‚ŒãŸæ–‡å­—ã‚³ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
            try {
                if (encoding === 'utf-8') {
                    reader.readAsText(currentFile, 'UTF-8');
                } else if (encoding === 'shift_jis') {
                    reader.readAsText(currentFile, 'Shift_JIS');
                } else if (encoding === 'euc-jp') {
                    reader.readAsText(currentFile, 'EUC-JP');
                } else {
                    reader.readAsText(currentFile, 'UTF-8'); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                }
            } catch (error) {
                previewEl.innerHTML = `<div style="color: #dc2626;">âŒ æ–‡å­—ã‚³ãƒ¼ãƒ‰ "${encoding}" ã§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
            }
        }

        function parseAndPreviewCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const previewEl = document.getElementById('csv-preview');
            const importBtn = document.getElementById('import-csv-btn');
            const hasHeader = document.getElementById('header-option').value === 'true';
            
            if (lines.length === 0 || (hasHeader && lines.length < 2)) {
                previewEl.innerHTML = '<div style="color: #dc2626;">âŒ CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã¾ãŸã¯ç„¡åŠ¹ã§ã™</div>';
                importBtn.style.display = 'none';
                return;
            }
            
            // CSVãƒ‘ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };
            
            let headers;
            let rows;
            
            if (hasHeader) {
                // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒã‚ã‚‹å ´åˆ
                headers = parseCSVLine(lines[0]);
                rows = lines.slice(1).map(line => parseCSVLine(line));
            } else {
                // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒãªã„å ´åˆ
                const firstRow = parseCSVLine(lines[0]);
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’åˆ—ç•ªå·ã§ç”Ÿæˆï¼ˆCol1, Col2, ...ï¼‰
                headers = Array.from({ length: firstRow.length }, (_, i) => `åˆ—${i+1}`);
                rows = lines.map(line => parseCSVLine(line));
            }
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
            let html = '<h4>ğŸ“‹ CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>';
            html += '<div style="overflow-x: auto; margin: 1rem 0;">';
            html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">';
            html += '<thead><tr>';
            headers.forEach(header => {
                html += `<th style="border: 1px solid #e5e7eb; padding: 0.5rem; background: #f9fafb; font-weight: 600;">${header}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            rows.slice(0, 5).forEach(row => {
                html += '<tr>';
                row.forEach(cell => {
                    html += `<td style="border: 1px solid #e5e7eb; padding: 0.5rem;">${cell}</td>`;
                });
                html += '</tr>';
            });
            
            if (rows.length > 5) {
                html += `<tr><td colspan="${headers.length}" style="border: 1px solid #e5e7eb; padding: 0.5rem; text-align: center; color: #6b7280; font-style: italic;">... ä»– ${rows.length - 5} ä»¶</td></tr>`;
            }
            
            html += '</tbody></table></div>';
            html += `<div style="color: #6b7280; font-size: 0.875rem;">ğŸ“Š åˆè¨ˆ: ${rows.length} ä»¶ã®ãƒ¬ã‚³ãƒ¼ãƒ‰</div>`;
            
            previewEl.innerHTML = html;
            importBtn.style.display = 'block';
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            window.csvData = { headers, rows, hasHeader };
        }

        async function importCSVData() {
            if (!window.csvData) {
                alert('CSVãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            const statusEl = document.getElementById('csv-status');
            const importBtn = document.getElementById('import-csv-btn');
            
            statusEl.style.display = 'block';
            statusEl.innerHTML = '<div style="color: #3b82f6; font-weight: 600;">ğŸ“¥ CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...</div><br>';
            importBtn.disabled = true;
            
            try {
                const { rows } = window.csvData;
                let successCount = 0;
                let errorCount = 0;
                
                // æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨è¨­å®šæƒ…å ±ã‚’è¡¨ç¤º
                const encoding = document.getElementById('encoding-select').value;
                const hasHeader = document.getElementById('header-option').value === 'true';
                
                statusEl.append(`<div style="color: #6b7280;">â„¹ï¸ æ–‡å­—ã‚³ãƒ¼ãƒ‰: ${encoding}, ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ: ${hasHeader ? 'ã‚ã‚Š' : 'ãªã—'}</div><br>`);
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const progress = Math.round(((i + 1) / rows.length) * 100);
                    const rowNum = hasHeader ? i + 2 : i + 1; // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒã‚ã‚‹å ´åˆã¯å®Ÿéš›ã®è¡Œç•ªå·ã‚’èª¿æ•´
                    
                    // å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°
                    // æƒ³å®š: year, day_of_week, period, semester, title, credit, professor_name, room_no
                    if (row.length < 8) {
                        statusEl.append(`<div style="color: #dc2626;">âŒ è¡Œ ${rowNum}: åˆ—æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ (${row.length}/8)</div>`);
                        errorCount++;
                        continue;
                    }
                    
                    // SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ã®ãŸã‚ã«ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
                    const escapedValues = row.map(val => {
                        if (typeof val === 'string') {
                            return val.replace(/'/g, "''");
                        }
                        return val;
                    });
                    
                    // UUIDã‚’è‡ªå‹•ç”Ÿæˆã—ã¦IDã¨ã—ã¦ä½¿ç”¨
                    const uuid = crypto.randomUUID();
                    
                    // year, day_of_week, period, semester, title, credit, professor_name, room_no
                    const insertSQL = `INSERT INTO classes (id, year, day_of_week, period, semester, title, credit, professor_name, room_no) 
                        VALUES ('${uuid}', ${escapedValues[0]}, '${escapedValues[1]}', ${escapedValues[2]}, '${escapedValues[3]}', '${escapedValues[4]}', ${escapedValues[5]}, '${escapedValues[6]}', '${escapedValues[7]}')`;
                    
                    try {
                        const result = await osql.connect(insertSQL, false);
                        if (result.status === 200) {
                            successCount++;
                            if (i % 10 === 0 || i === rows.length - 1) {
                                statusEl.append(`<div style="color: #059669;">âœ… ${successCount} ä»¶å‡¦ç†å®Œäº† (é€²æ—: ${progress}%)</div>`);
                            }
                        } else {
                            statusEl.append(`<div style="color: #dc2626;">âŒ è¡Œ ${rowNum}: ${result.message}</div>`);
                            errorCount++;
                        }
                    } catch (error) {
                        statusEl.append(`<div style="color: #dc2626;">âŒ è¡Œ ${rowNum}: ${error.message}</div>`);
                        errorCount++;
                    }
                }
                
                statusEl.append(`<div style="background: #d1fae5; color: #065f46; padding: 1rem; border-radius: 0.5rem; border: 1px solid #a7f3d0; margin-top: 1rem; font-weight: 600;">ğŸ‰ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼æˆåŠŸ: ${successCount}ä»¶ã€å¤±æ•—: ${errorCount}ä»¶</div>`);
                
            } catch (error) {
                statusEl.append(`<div style="background: #fee2e2; color: #991b1b; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fecaca; margin-top: 1rem; font-weight: 600;">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`);
            } finally {
                importBtn.disabled = false;
            }
        }
    </script>
</head>

<body>
    <!-- Smart Header -->
    <header class="smart-header">
        <div class="smart-header-container">
            <div class="smart-header-left">
                <a href="../index.html" class="smart-header-brand">
                    <span class="smart-header-logo">ğŸ› ï¸</span>
                    <div>
                        <h1 class="smart-header-title">SmartCampus</h1>
                        <span class="smart-header-subtitle">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</span>
                    </div>
                </a>
                <nav class="smart-header-nav">
                    <a href="../index.html" class="smart-header-nav-item">
                        ğŸ  <span>ãƒ›ãƒ¼ãƒ </span>
                    </a>
                    <a href="../items/index.html" class="smart-header-nav-item">
                        ğŸ“¦ <span>åœ¨åº«ç®¡ç†</span>
                    </a>
                    <a href="../history/index.html" class="smart-header-nav-item">
                        ğŸ“‹ <span>å±¥æ­´</span>
                    </a>
                    <a href="initdb.html" class="smart-header-nav-item active">
                        âš™ï¸ <span>DBåˆæœŸåŒ–</span>
                    </a>
                </nav>
            </div>
            <div class="smart-header-right">
                <div class="smart-header-user" onclick="isapp.openUserProfile('..')">
                    <div class="smart-header-user-icon" id="user-initials">ğŸ‘¤</div>
                    <span class="smart-header-username" id="header-username">Loading...</span>
                </div>
                <button class="smart-header-logout" onclick="isapp.logout()">
                    ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
            </div>
        </div>
    </header>
    
    <!-- Smart Breadcrumb -->
    <nav class="smart-breadcrumb">
        <div class="smart-breadcrumb-container">
            <a href="../index.html">ãƒ›ãƒ¼ãƒ </a>
            <span class="smart-breadcrumb-separator">></span>
            <a href="index.html">ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†</a>
            <span class="smart-breadcrumb-separator">></span>
            <span class="smart-breadcrumb-current">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–</span>
        </div>
    </nav>
    <div class="container">
        <div class="admin-card">
            <h1>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–</h1>
            <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: #dc2626; font-weight: 600; margin-bottom: 0.5rem;">
                    âš ï¸ é‡è¦ãªè­¦å‘Š
                </div>
                <p style="color: #7f1d1d; margin: 0; font-size: 0.875rem;">
                    ã“ã®æ“ä½œã«ã‚ˆã‚Šæ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚
                </p>
            </div>
            <button onclick="initializeDatabase()" style="background: #dc2626; margin: 1rem 0;">
                ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
            </button>
            <div id="status-message" style="display: none;">å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
        </div>
        
        <div class="admin-card">
            <h2>ğŸ“¥ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2>
            <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: #0369a1; font-weight: 600; margin-bottom: 0.5rem;">
                    â„¹ï¸ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                </div>
                <p style="color: #0c4a6e; margin: 0; font-size: 0.875rem;">
                    åˆ—é †: id, year, day_of_week, period, semester, title, credit, professor_name, room_no<br>
                    ä¾‹: "CS101",2024,"æœˆ",1,"å‰æœŸ","ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤",2,"ç”°ä¸­å¤ªéƒ","A101"
                </p>
            </div>
            
            <div style="background: #fefce8; border: 1px solid #fde047; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: #a16207; font-weight: 600; margin-bottom: 0.5rem;">
                    ğŸ’¡ ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¨­å®šã®ãƒ’ãƒ³ãƒˆ
                </div>
                <ul style="color: #a16207; margin: 0 0 0.5rem 0; padding-left: 1.5rem; font-size: 0.875rem;">
                    <li><strong>æ–‡å­—ã‚³ãƒ¼ãƒ‰</strong>: æ–‡å­—åŒ–ã‘ã™ã‚‹å ´åˆã¯åˆ¥ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠ</li>
                    <li><strong>ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ</strong>: Excelãªã©ã§åˆ—åãŒã‚ã‚‹å ´åˆã¯ã€Œã‚ã‚Šã€ã‚’é¸æŠ</li>
                </ul>
                <p style="color: #a16207; margin: 0; font-size: 0.875rem;">
                    CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠå¾Œã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„
                </p>
            </div>
            
            <div style="margin: 1rem 0;">
                <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
                    <div style="flex: 1; min-width: 200px;">
                        <label for="encoding-select" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                            ğŸŒ æ–‡å­—ã‚³ãƒ¼ãƒ‰
                        </label>
                        <select id="encoding-select" onchange="loadCSVWithEncoding()" style="display: block; width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; background: white;">
                            <option value="utf-8">UTF-8 (æ¨å¥¨)</option>
                            <option value="shift_jis">Shift_JIS (Windowsæ¨™æº–)</option>
                            <option value="euc-jp">EUC-JP (Unixç³»)</option>
                        </select>
                        <p style="color: #6b7280; font-size: 0.75rem; margin-top: 0.25rem;">
                            æ–‡å­—åŒ–ã‘ã—ãŸå ´åˆã¯åˆ¥ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ãŠè©¦ã—ãã ã•ã„
                        </p>
                    </div>
                    
                    <div style="flex: 1; min-width: 200px;">
                        <label for="header-option" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                            ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
                        </label>
                        <select id="header-option" onchange="loadCSVWithEncoding()" style="display: block; width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; background: white;">
                            <option value="true">ã‚ã‚Šï¼ˆ1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨ï¼‰</option>
                            <option value="false">ãªã—ï¼ˆå…¨ã¦ã®è¡Œã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ï¼‰</option>
                        </select>
                    </div>
                </div>
                
                <label for="csv-file" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    ğŸ“ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                </label>
                <input type="file" id="csv-file" accept=".csv" onchange="handleCSVFile(event)" 
                       style="display: block; width: 100%; padding: 0.5rem; border: 2px dashed #d1d5db; border-radius: 0.5rem; background: #f9fafb;">
            </div>
            
            <div id="csv-preview" style="margin: 1rem 0;"></div>
            
            <button id="import-csv-btn" onclick="importCSVData()" 
                    style="background: #059669; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; display: none; margin: 1rem 0;">
                ğŸ“¥ CSVãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
            </button>
            
            <div id="csv-status" style="display: none; margin-top: 1rem;"></div>
        </div>
        
        <div class="admin-card">
            <h2 style="border-bottom: 2px solid #e5e7eb; padding-bottom: 0.75rem;">ãã®ä»–ã®ãƒ„ãƒ¼ãƒ«</h2>
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="width: 48px; height: 48px; background: #3b82f6; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                        ğŸ—„ï¸
                    </div>
                    <div>
                        <h3 style="margin: 0; color: #1f2937; font-weight: 600;">dbkisoã‚µãƒ¼ãƒ</h3>
                        <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹</p>
                    </div>
                </div>
                <a href="https://dbkiso.si.aoyama.ac.jp" target="_blank" 
                   style="background: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; font-size: 0.875rem; text-decoration: none;">
                    ã‚¢ã‚¯ã‚»ã‚¹ â†’
                </a>
            </div>
        </div>
    </div>

    <script>
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ¶å¾¡
        function showStatusMessage() {
            const statusEl = document.getElementById('status-message');
            statusEl.style.display = 'block';
            statusEl.innerHTML = '';
        }
    </script>
</body>

</html>